# Copyright 2024 KU Leuven.
# Licensed under the Apache License, Version 2.0, see LICENSE for details.
# SPDX-License-Identifier: Apache-2.0

# Yunhao Deng <yunhao.deng@kuleuven.be>

# Run functional regression checks
name: ci
on:
  pull_request:
  push:
    branches: [main]
jobs:

  ########
  # Docs #
  ########

  # docs:
  #   name: Build documentation
  #   runs-on: ubuntu-22.04
  #   container:
  #     image: ghcr.io/pulp-platform/occamy:main
  #   steps:
  #     - uses: actions/checkout@v2
  #     - name: Build docs
  #       run: |
  #         bender update && bender checkout
  #         mkdocs build

  #################################################
  # HeMAiA System Software + Hardware Compilation #
  #################################################

  hemaia-verilator:
    name: Simulation with Verilator
    runs-on: ubuntu-22.04
    container:
      image: ghcr.io/kuleuven-micas/snax:main
    steps:
      - name: Install Git
        run: |
          apt-get update
          apt-get install -y git
      - uses: actions/checkout@v2
        with:
          submodules: "recursive"
      - name: Compile everything
        run: |
          make sw CFG_OVERRIDE=target/rtl/cfg/hemaia_ci.hjson -j
          make bootrom CFG_OVERRIDE=target/rtl/cfg/hemaia_ci.hjson -j
          make rtl CFG_OVERRIDE=target/rtl/cfg/hemaia_ci.hjson
          make hemaia_system_vlt -j2
          make -C target/sim_chip/apps apps
